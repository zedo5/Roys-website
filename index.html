<!doctype html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>WM GROUP</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root{
            --black:#1e1e1e;
            --grey:#6f6f6f;
            --white:#ffffff;
            --container: 1200px;
            --shadow: 0 18px 50px rgba(0,0,0,.14);
            --soft-shadow: 0 12px 30px rgba(0,0,0,.10);
        }

        *{box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{
            margin:0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color:var(--black);
            background:var(--white);
            line-height:1.45;
        }
        a{color:inherit;text-decoration:none}
        img{max-width:100%;display:block}
        .container{max-width: var(--container); margin: 0 auto; padding: 0 22px;}

        /* Top bar */
        .topbar{
            position: sticky; top: 0; z-index: 50;
            background: rgba(255,255,255,.92);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(30,30,30,.08);
        }
        .nav{
            display:flex; align-items:center; justify-content:space-between;
            gap: 16px; padding: 14px 0;
        }
        .brand{
            display:flex; align-items:center; gap:10px;
            line-height:1.1;
        }
        .brand .logo{
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 12px;
        }
        .brand strong{font-weight:800;letter-spacing:.02em;font-size:18px}

        .navright{display:flex;gap:14px;align-items:center}
        .navlinks{display:flex;gap:18px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
        .navlinks a{font-size:12px;opacity:.9}

        /* Language toggle */
        .langbtn{
            font: inherit;
            font-size: 12px;
            font-weight: 700;
            border: 1px solid rgba(30,30,30,.14);
            background: #fff;
            padding: 8px 12px;
            border-radius: 999px;
            cursor: pointer;
            letter-spacing: .02em;
            display:flex;
            align-items:center;
            gap:8px;
            user-select:none;
        }
        .langdot{
            width: 8px; height: 8px; border-radius: 999px;
            background: rgba(30,30,30,.55);
        }
        .langbtn:active{transform: translateY(1px);}

        /* HERO */
        .hero{padding:18px 0 0}
        .hero .container{max-width: 100%; padding: 0;}

        .hero-media{
            position:relative;
            overflow:hidden;
            background:#eee;
            border-bottom: 1px solid rgba(30,30,30,.08);
        }

        /* Center-split open wipes */
        .wipe{
            position:absolute; top:0; width:50%; height:100%;
            background: var(--white); z-index: 7; pointer-events:none;
            transform: scaleX(1);
        }
        .wipe.split.left{left:0; transform-origin:left;}
        .wipe.split.right{right:0; transform-origin:right;}

        /* HERO carousel */
        .hero-slider{
            position: relative;
            width: 100%;
            height: clamp(520px, 82vh, 860px);
            z-index: 1;
        }

        .hero-track{
            display: flex;
            height: 100%;
            width: 100%;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-snap-stop: always;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            cursor: grab;
            touch-action: pan-y;
        }
        .hero-track::-webkit-scrollbar{ display:none; }
        .hero-track.dragging{ cursor: grabbing; }

        .hero-slide{
            flex: 0 0 100%;
            height: 100%;
            scroll-snap-align: start;
            position: relative;
        }
        .hero-slide img{
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform-origin:center;
            user-select:none;
            -webkit-user-drag:none;
        }

        /* Arrows (clean) */
        .hero-arrow{
            position:absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 46px;
            height: 46px;
            min-width: 46px;
            max-width: 46px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,.35);
            background: rgba(20,20,20,.35);
            backdrop-filter: blur(10px);
            display:flex;
            align-items:center;
            justify-content:center;
            color: rgba(255,255,255,.92);
            cursor:pointer;
            padding: 0;
            appearance: none;
            -webkit-appearance: none;
            z-index: 6;
            transition: transform .15s ease, opacity .2s ease;
            opacity: .95;
        }
        .hero-arrow:hover{ opacity: 1; }
        .hero-arrow:active{ transform: translateY(-50%) scale(.98); }
        .hero-arrow.left{ left: 18px; }
        .hero-arrow.right{ right: 18px; }
        .hero-arrow svg{ width: 18px; height: 18px; }

        /* Dots */
        .hero-dots{
            position:absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 16px;
            z-index: 6;
            display:flex;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 999px;
            background: rgba(20,20,20,.18);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,.18);
        }
        .hero-dot{
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: rgba(255,255,255,.55);
            opacity: .9;
            cursor: pointer;
        }
        .hero-dot.active{
            width: 18px;
            background: rgba(255,255,255,.92);
            opacity: 1;
        }

        section{padding: 80px 0;}
        .split{
            display:grid;
            grid-template-columns: 1fr 520px;
            gap: 60px;
            align-items:start;
        }
        #services .split{
            grid-template-columns: minmax(220px, 360px) minmax(0, 1fr);
            gap: 40px;
        }
        .big-title{
            font-size: clamp(44px, 6vw, 74px);
            font-weight: 800;
            letter-spacing: -0.03em;
            margin: 0;
            text-transform: uppercase;
        }
        .right{justify-self:end;width:100%}

        /* About */
        .about-copy p{
            margin: 0 0 14px;
            color: var(--grey);
            font-size: 14px;
            max-width: 58ch;
            white-space: pre-wrap;
        }

        /* Services accordion */
        .accordion{border-top: 1px solid rgba(30,30,30,.12)}
        .acc-item{border-bottom: 1px solid rgba(30,30,30,.12); padding: 18px 0}
        .acc-head{
            display:grid;
            grid-template-columns: 58px 1fr 28px;
            gap: 12px;
            align-items:center;
            cursor:pointer;
            user-select:none;
        }
        .acc-num{font-size: 12px;color: var(--grey); font-weight:700;}
        .acc-title{font-weight: 700;font-size: 14px}
        .acc-plus{font-size: 22px; line-height: 1; justify-self:end; transition: transform .25s ease;}
        .acc-panel{
            display:grid;
            grid-template-columns: minmax(0, 1fr) minmax(260px, 460px);
            gap: 22px;
            padding: 14px 0 0 70px;
            overflow:hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height .45s ease, opacity .35s ease;
            align-items: start;
        }
        .acc-item.open .acc-panel{max-height: 900px; opacity: 1}
        .acc-item.open .acc-plus{transform: rotate(45deg)}
        .acc-panel p{
            margin:0 0 12px;
            color:var(--grey);
            font-size:13px;
            line-height: 1.75;
            max-width: none;              /* FIX: no skinny column */
            white-space:pre-wrap;
        }
        .bullets{
            margin:0;
            padding-left:16px;
            color:var(--grey);
            font-size:12px;
            display:grid;
            gap:6px;
            line-height: 1.65;
        }
        .acc-panel img{
            width:100%;
            height: 250px;               /* bigger service image */
            object-fit:cover;
            border-radius:14px;
            box-shadow: var(--soft-shadow);
        }

        /* Projects */
        .projects-wrap{margin-top: 20px;}
        .project{position: relative; padding: 38px 0;}
        .project .img{width: 100%; height: clamp(340px, 50vh, 520px); object-fit: cover;}
        .project .card{
            position:absolute; top: 88px; width: 340px;
            background: rgba(255,255,255,.92);
            border: 1px solid rgba(30,30,30,.10);
            box-shadow: var(--shadow);
            padding: 22px;
        }
        .project.right .card{right: 0;}
        .project.left  .card{left: 0;}
        .project h3{margin:0 0 8px;font-size:14px;font-weight:800}
        .project .meta{font-size:11px;color:var(--grey);margin:0 0 10px}
        .project .desc{margin:0;color:var(--grey);font-size:12px;line-height:1.6;white-space:pre-wrap}

        /* Gallery */
        .gallery-title-center{
            text-align:center;
            font-size: clamp(64px, 10vw, 150px);
            font-weight: 800;
            letter-spacing: -0.02em;
            margin: 0;
            padding: 0 0 40px;
            text-transform: uppercase;
        }
        .gallery-stage{position: relative; height: 560px; margin-top: 10px; overflow: visible;}
        .gallery-word{
            position:absolute; left: 50%; top: 48%;
            transform: translate(-50%,-50%);
            font-size: clamp(70px, 10vw, 160px);
            font-weight: 800; letter-spacing: .06em;
            color: rgba(30,30,30,.18);
            text-transform: uppercase;
            white-space:nowrap;
            user-select:none;
            pointer-events:none;
        }
        .g{position:absolute; box-shadow: var(--soft-shadow); overflow:hidden; background:#f2f2f2; border-radius:16px;}
        .g img{width:100%;height:100%;object-fit:cover}
        .g1{left: 14%; top: 160px; width: 260px; height: 260px;}
        .g2{left: 42%; top: 12px;  width: 340px; height: 380px;}
        .g3{left: 72%; top: 260px; width: 260px; height: 260px;}
        .g4{left: 30%; top: -40px; width: 320px; height: 220px;}
        .g5{left: 66%; top: -60px; width: 320px; height: 220px;}

        /* Partner */
        .partner{padding: 0; background: var(--white);}
        .partner-grid{display:grid; grid-template-columns: 1fr 1fr; min-height: 720px;}
        .partner-left{padding: 90px 70px 60px 70px;}
        .partner-title{
            margin:0 0 18px;
            font-size: 76px; line-height: 0.95;
            font-weight: 800; letter-spacing: -0.04em;
            text-transform: uppercase;
        }
        .partner-desc{margin:0 0 18px;color: var(--grey);font-size: 14px;max-width: 62ch;white-space:pre-wrap}

        .contact-list{display:grid; gap: 14px; margin-top: 10px; max-width: 600px;}
        .contact-row{
            display:flex;
            align-items:flex-start;
            gap: 12px;
            color: rgba(30,30,30,.78);
            font-weight: 700;
        }
        .contact-row svg{width: 22px; height: 22px; flex: 0 0 auto; margin-top: 2px; opacity:.85;}
        .contact-row .label{min-width: 110px; color: rgba(30,30,30,.55); font-weight: 800;}
        .contact-row a{color: rgba(30,30,30,.78); text-decoration:none;}
        .contact-row a:hover{opacity:.85}
        .contact-row .value{font-weight: 700; color: rgba(30,30,30,.78); white-space: pre-wrap;}

        .partner-right{position: relative; overflow:hidden; background:#eee;}
        .partner-right img{width:100%; height:100%; object-fit: cover; transform-origin:center;}

        /* Reveals */
        .reveal{opacity:0; transform: translateY(18px);}
        .reveal-left{opacity:0; transform: translateX(-22px);}
        .reveal-right{opacity:0; transform: translateX(22px);}

        /* RTL adjustments */
        html[dir="rtl"] .about-copy, html[dir="rtl"] .partner-left{ text-align:right; }
        html[dir="rtl"] .acc-panel{padding: 14px 70px 0 0;}
        html[dir="rtl"] .bullets{padding-left:0; padding-right:16px;}
        html[dir="rtl"] .project.right .card{right:auto; left:0;}
        html[dir="rtl"] .project.left  .card{left:auto; right:0;}
        html[dir="rtl"] .contact-row{flex-direction: row-reverse;}
        html[dir="rtl"] .contact-row .label{min-width: 120px; text-align:right;}

        @media (max-width: 980px){
            .split{grid-template-columns: minmax(150px, 220px) minmax(0, 1fr); gap: 24px;}
            #services .split{grid-template-columns: minmax(170px, 240px) minmax(0, 1fr); gap: 28px;}
            .big-title{font-size: clamp(36px, 8.4vw, 58px);}
            .right{justify-self:start; max-width: 720px;}
            .project .card{position:relative; top:auto; left:auto; right:auto; width: 100%; margin-top: 16px;}
            .gallery-stage{height: 680px;}
            .gallery-word{display:none;}
            .navlinks{display:none;}
            .partner-grid{grid-template-columns:1fr}
            .partner-left{padding: 64px 22px}
            .partner-title{font-size: 56px}

            /* Services: stack on mobile */
            .acc-panel{grid-template-columns: 1fr; padding-left: 0; gap: 18px;}
            .acc-head{grid-template-columns: 58px 1fr 28px;}
            .acc-panel img{height: 220px;}
        }

        @media (max-width: 520px){
            section{padding: 56px 0;}
            .brand strong{font-size:15px}
            .hero-arrow{ display:none; } /* swipe on phone, no arrows */
            .split{grid-template-columns: minmax(120px, 180px) minmax(0, 1fr); gap: 18px;}
            #services .split{grid-template-columns: minmax(140px, 200px) minmax(0, 1fr); gap: 22px;}
            .partner-left{padding: 48px 18px}
            .partner-title{font-size: 42px}
            .contact-row .label{min-width: 90px;}
            .acc-panel img{height: 200px;}
        }

        @media (max-width: 768px){
            /* Mobile collage positions (avoid overlap) */
            .gallery-stage{
                height: 600px;
                overflow: hidden;
                margin-bottom: 24px;
            }
            .gallery-word{ display: none; }
            .g4{ left: 6%;  top: 20px;  width: 46%; height: 150px; }
            .g5{ left: 52%; top: 20px;  width: 42%; height: 150px; }
            .g1{ left: 6%;  top: 190px; width: 42%; height: 190px; }
            .g2{ left: 46%; top: 160px; width: 48%; height: 260px; }
            .g3{ left: 10%; top: 400px; width: 84%; height: 200px; }
        }
    </style>
</head>

<body>
<header class="topbar">
    <div class="container">
        <div class="nav">
            <a class="brand" href="#top">
                <img class="logo" id="brandLogo" src="./assets/uploads/logo.png" alt="Logo" />
                <strong id="brandName">WM GROUP</strong>
            </a>

            <div class="navright">
                <nav class="navlinks" aria-label="Primary">
                    <a href="#about" id="navAbout">About</a>
                    <a href="#services" id="navServices">Services</a>
                    <a href="#projects" id="navProjects">Projects</a>
                    <a href="#gallery" id="navGallery">Gallery</a>
                    <a href="#partner" id="navPartner">Partner</a>
                </nav>

                <button id="langToggle" class="langbtn" type="button" aria-label="Change language">
                    <span class="langdot" aria-hidden="true"></span>
                    <span id="langLabel">English</span>
                </button>
            </div>
        </div>
    </div>
</header>

<!-- HERO -->
<main id="top" class="hero">
    <div class="container">
        <div class="hero-media" id="heroMedia">
            <div class="wipe split left" data-wipe-left></div>
            <div class="wipe split right" data-wipe-right></div>

            <div class="hero-slider" id="heroSlider">
                <div class="hero-track" id="heroTrack" aria-label="Hero images"></div>

                <button class="hero-arrow left" id="heroPrev" type="button" aria-label="Previous">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"></path>
                    </svg>
                </button>

                <button class="hero-arrow right" id="heroNext" type="button" aria-label="Next">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 6l6 6-6 6"></path>
                    </svg>
                </button>

                <div class="hero-dots" id="heroDots" aria-label="Hero dots"></div>
            </div>
        </div>
    </div>
</main>

<!-- ABOUT -->
<section id="about">
    <div class="container">
        <div class="split">
            <h2 class="big-title reveal-left" id="aboutTitle">ABOUT</h2>
            <div class="right about-copy">
                <p id="aboutP1" class="reveal"></p>
                <p id="aboutP2" class="reveal"></p>
            </div>
        </div>
    </div>
</section>

<!-- SERVICES -->
<section id="services">
    <div class="container">
        <div class="split">
            <h2 class="big-title reveal-left" id="servicesTitle">SERVICES</h2>
            <div class="right reveal">
                <div class="accordion" id="servicesAccordion"></div>
            </div>
        </div>
    </div>
</section>

<!-- PROJECTS -->
<section id="projects">
    <div class="container">
        <div class="split">
            <h2 class="big-title reveal-left" id="projectsTitle">PROJECTS</h2>
            <div class="right"></div>
        </div>
        <div class="projects-wrap" id="projectsWrap"></div>
    </div>
</section>

<!-- GALLERY -->
<section id="gallery">
    <div class="container">
        <h2 class="gallery-title-center reveal" id="galleryTitle">GALLERY</h2>

        <div class="gallery-stage" id="galleryStage">
            <div class="gallery-word reveal" id="galleryWord">GALLERY</div>
        </div>
    </div>
</section>

<!-- PARTNER -->
<section id="partner" class="partner">
    <div class="partner-grid">
        <div class="partner-left">
            <h2 class="partner-title reveal-left" id="partnerTitle"></h2>
            <p class="partner-desc reveal" id="partnerDesc"></p>
            <div class="contact-list reveal" id="contactList"></div>
        </div>

        <div class="partner-right reveal-right">
            <img id="partnerImg" src="./assets/uploads/picture-14.jpg" alt="Partner" />
        </div>
    </div>
</section>

<!-- GSAP -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>

<script>
    function escapeHtml(s){
        return String(s ?? "")
            .replaceAll("&","&amp;")
            .replaceAll("<","&lt;")
            .replaceAll(">","&gt;")
            .replaceAll('"',"&quot;")
            .replaceAll("'","&#039;");
    }

    // Arabic-Indic digits: ٠١٢٣٤٥٦٧٨٩
    const AR_DIGITS = ["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];
    function toArabicIndicDigits(str){
        return String(str ?? "").replace(/\d/g, d => AR_DIGITS[Number(d)]);
    }

    let SITE = null;
    let LANG = "en";

    function getLang(){
        return localStorage.getItem("lang") || (SITE?.langDefault ?? "en");
    }
    function setLang(lang){
        LANG = (lang === "ar") ? "ar" : "en";
        localStorage.setItem("lang", LANG);
        document.documentElement.lang = LANG;
        document.documentElement.dir = (LANG === "ar") ? "rtl" : "ltr";
    }

    // localized field: string OR {en, ar}
    function t(value){
        if (value == null) return "";
        if (typeof value === "string") return value;
        return value[LANG] ?? value.en ?? value.ar ?? "";
    }

    function maybeLocalizeDigits(str){
        return (LANG === "ar") ? toArabicIndicDigits(str) : String(str ?? "");
    }

    /* ---------------- HERO CAROUSEL ---------------- */

    const HERO = {
        index: 0,
        timer: null,
        intervalMs: 4500,
        userInteractedAt: 0,
        isWrapping: false,
    };

    function heroImages(){
        const fromNew = Array.isArray(SITE?.hero?.images) ? SITE.hero.images : [];
        const fallbackSingle = SITE?.hero?.image ? [{ image: SITE.hero.image }] : [];
        const list = (fromNew.length ? fromNew : fallbackSingle)
            .map(x => x?.image)
            .filter(Boolean);
        return list;
    }

    function heroBuild(){
        const track = document.getElementById("heroTrack");
        const dots = document.getElementById("heroDots");
        if (!track || !dots) return;

        const imgs = heroImages();
        track.innerHTML = "";
        dots.innerHTML = "";

        imgs.forEach((src, i) => {
            const slide = document.createElement("div");
            slide.className = "hero-slide";
            slide.innerHTML = `<img ${i===0 ? 'loading="eager"' : 'loading="lazy"'} src="${escapeHtml(src)}" alt="Hero ${i+1}">`;
            track.appendChild(slide);

            const dot = document.createElement("div");
            dot.className = "hero-dot" + (i===0 ? " active" : "");
            dot.setAttribute("role","button");
            dot.setAttribute("tabindex","0");
            dot.setAttribute("aria-label", "Go to slide " + (i+1));
            dot.onclick = () => heroGo(i, true);
            dot.onkeydown = (e) => { if(e.key==="Enter"||e.key===" "){ e.preventDefault(); heroGo(i, true);} };
            dots.appendChild(dot);
        });

        HERO.index = 0;
        heroUpdateDots();
        heroBindDrag(track);
        heroBindButtons();
        heroStartAutoplay();
    }

    function heroSlideCount(){
        return heroImages().length;
    }

    function heroUpdateDots(){
        const dots = Array.from(document.querySelectorAll("#heroDots .hero-dot"));
        dots.forEach((d,i) => d.classList.toggle("active", i===HERO.index));
    }

    function heroClearClones(track){
        Array.from(track.querySelectorAll(".hero-clone")).forEach((n) => n.remove());
    }

    function heroWrapSlide(direction){
        const track = document.getElementById("heroTrack");
        if (!track || HERO.isWrapping) return;
        const count = heroSlideCount();
        if (count <= 1) return;

        const slides = Array.from(track.querySelectorAll(".hero-slide"));
        if (!slides.length) return;

        const w = track.clientWidth || 1;
        HERO.isWrapping = true;
        track.style.scrollSnapType = "none";

        if (direction === "next"){
            const clone = slides[0].cloneNode(true);
            clone.classList.add("hero-clone");
            track.appendChild(clone);
            track.scrollTo({ left: count * w, behavior: "smooth" });
            setTimeout(() => {
                heroClearClones(track);
                heroJump(0);
                track.style.scrollSnapType = "x mandatory";
                HERO.isWrapping = false;
            }, 360);
        } else {
            const clone = slides[slides.length - 1].cloneNode(true);
            clone.classList.add("hero-clone");
            track.insertBefore(clone, slides[0]);
            track.scrollLeft = track.scrollLeft + w;
            track.scrollTo({ left: 0, behavior: "smooth" });
            setTimeout(() => {
                heroClearClones(track);
                heroJump(count - 1);
                track.style.scrollSnapType = "x mandatory";
                HERO.isWrapping = false;
            }, 360);
        }
    }

    function heroJump(idx){
        const track = document.getElementById("heroTrack");
        if (!track) return;
        const count = heroSlideCount();
        if (!count) return;

        HERO.index = (idx + count) % count;
        heroUpdateDots();

        track.style.scrollSnapType = "none";
        track.style.scrollBehavior = "auto";
        track.scrollLeft = HERO.index * track.clientWidth;

        requestAnimationFrame(() => {
            track.style.scrollSnapType = "x mandatory";
            track.style.scrollBehavior = "";
        });
    }

    function heroGo(idx, user=false){
        const track = document.getElementById("heroTrack");
        if (!track) return;

        const count = heroSlideCount();
        if (!count) return;

        if (user && count > 1 && (idx < 0 || idx >= count)){
            heroWrapSlide(idx < 0 ? "prev" : "next");
            return;
        }

        HERO.index = (idx + count) % count;
        heroUpdateDots();

        const x = HERO.index * track.clientWidth;
        track.scrollTo({ left: x, behavior: "smooth" });

        if (user){
            HERO.userInteractedAt = Date.now();
        }
    }

    function heroNext(user=false){ heroGo(HERO.index + 1, user); }
    function heroPrev(user=false){ heroGo(HERO.index - 1, user); }

    function heroStartAutoplay(){
        heroStopAutoplay();
        if (heroSlideCount() <= 1) return;

        HERO.timer = setInterval(() => {
            const now = Date.now();
            // pause briefly after user interaction
            if (now - HERO.userInteractedAt < 3500) return;
            heroNext(false);
        }, HERO.intervalMs);
    }

    function heroStopAutoplay(){
        if (HERO.timer){ clearInterval(HERO.timer); HERO.timer = null; }
    }

    function heroBindButtons(){
        const next = document.getElementById("heroNext");
        const prev = document.getElementById("heroPrev");
        if (next) next.onclick = () => heroNext(true);
        if (prev) prev.onclick = () => heroPrev(true);

        // Keyboard arrows when hero is visible
        window.onkeydown = (e) => {
            const hero = document.getElementById("heroMedia");
            if (!hero) return;
            const r = hero.getBoundingClientRect();
            const visible = r.top < window.innerHeight && r.bottom > 0;
            if (!visible) return;

            if (e.key === "ArrowRight") heroNext(true);
            if (e.key === "ArrowLeft") heroPrev(true);
        };
    }

    function heroBindDrag(track){
        let isDown = false;
        let startX = 0;
        let startScroll = 0;
        let touchStartX = 0;
        let touchStartY = 0;
        let touchStartIndex = 0;
        let touchStartScroll = 0;
        let isTouching = false;

        const pointerDown = (e) => {
            isDown = true;
            track.classList.add("dragging");
            startX = (e.touches ? e.touches[0].pageX : e.pageX);
            startScroll = track.scrollLeft;
            HERO.userInteractedAt = Date.now();
            heroStopAutoplay();
        };

        const pointerMove = (e) => {
            if (!isDown) return;
            const x = (e.touches ? e.touches[0].pageX : e.pageX);
            const dx = x - startX;
            track.scrollLeft = startScroll - dx;
        };

        const pointerUp = () => {
            if (!isDown) return;
            isDown = false;
            track.classList.remove("dragging");

            // snap to nearest slide
            const w = track.clientWidth || 1;
            const idx = Math.round(track.scrollLeft / w);
            heroGo(idx, true);

            heroStartAutoplay();
        };

        // Mouse
        track.addEventListener("mousedown", pointerDown);
        window.addEventListener("mousemove", pointerMove);
        window.addEventListener("mouseup", pointerUp);

        // Touch: rely on native scroll-snap; just pause autoplay on interaction
        track.addEventListener("touchstart", (e) => {
            touchStartX = e.touches ? e.touches[0].pageX : 0;
            touchStartY = e.touches ? e.touches[0].pageY : 0;
            touchStartScroll = track.scrollLeft;
            const w = track.clientWidth || 1;
            touchStartIndex = Math.round(touchStartScroll / w);
            isTouching = true;
            HERO.userInteractedAt = Date.now();
            heroStopAutoplay();
        }, { passive: true });
        track.addEventListener("touchmove", (e) => {
            if (!isTouching || !e.touches || !e.touches[0]) return;
            const currentX = e.touches[0].pageX;
            const currentY = e.touches[0].pageY;
            const dx = currentX - touchStartX;
            const dy = currentY - touchStartY;
            const isHorizontal = Math.abs(dx) > Math.abs(dy) + 6;
            if (!isHorizontal) return;
            e.preventDefault();
            track.scrollLeft = touchStartScroll - dx;
        }, { passive: false });
        track.addEventListener("touchend", (e) => {
            if (!isTouching) return;
            isTouching = false;
            const endX = e.changedTouches ? e.changedTouches[0].pageX : 0;
            const dx = endX ? (touchStartX - endX) : 0;
            const swipeThreshold = 24;
            const count = heroSlideCount();
            if (!count){
                heroStartAutoplay();
                return;
            }
            const w = track.clientWidth || 1;
            const maxScroll = track.scrollWidth - w;
            const atStart = touchStartIndex === 0;
            const atEnd = touchStartIndex === count - 1;

            if (dx > swipeThreshold){
                if (atEnd){
                    heroWrapSlide("next");
                } else {
                    heroGo(touchStartIndex + 1, true);
                }
            } else if (dx < -swipeThreshold){
                if (atStart){
                    heroWrapSlide("prev");
                } else {
                    heroGo(touchStartIndex - 1, true);
                }
            } else {
                const idx = Math.round(track.scrollLeft / w);
                heroGo(idx, true);
            }
            heroStartAutoplay();
        }, { passive: true });

        // When user scrolls track via inertia
        track.addEventListener("scroll", () => {
            const w = track.clientWidth || 1;
            const idx = Math.round(track.scrollLeft / w);
            if (idx !== HERO.index){
                HERO.index = idx;
                heroUpdateDots();
            }
        }, { passive: true });
    }

    /* ---------------- SERVICES ---------------- */

    function renderServices(services){
        const wrap = document.getElementById("servicesAccordion");
        if (!wrap) return;

        const list = Array.isArray(services) ? services : [];
        wrap.innerHTML = list.map((s, idx) => {
            const open = idx === 0 ? "open" : "";
            const numRaw = s?.num ?? String(idx+1).padStart(2,"0");
            const num = (LANG === "ar") ? toArabicIndicDigits(numRaw) : String(numRaw);

            const bullets = Array.isArray(s?.bullets) ? s.bullets : [];
            const bulletsHtml = bullets.map(b => `<li>${escapeHtml(t(b?.bullet ?? b))}</li>`).join("");

            const title = t(s?.title);
            const text = t(s?.text);
            const img = s?.image ?? "";

            return `
        <div class="acc-item ${open}">
          <div class="acc-head" role="button" tabindex="0" aria-expanded="${idx === 0 ? "true" : "false"}">
            <div class="acc-num">${escapeHtml(num)}</div>
            <div class="acc-title">${escapeHtml(title)}</div>
            <div class="acc-plus">+</div>
          </div>

          <div class="acc-panel">
            <div>
              <p>${escapeHtml(text)}</p>
              <ul class="bullets">${bulletsHtml}</ul>
            </div>
            <img src="${escapeHtml(img)}" alt="${escapeHtml(title)}" />
          </div>
        </div>
      `;
        }).join("");
    }

    function initAccordion(){
        const items = Array.from(document.querySelectorAll('#servicesAccordion .acc-item'));
        const toggle = (item) => {
            const isOpen = item.classList.contains('open');
            items.forEach(i => {
                i.classList.remove('open');
                i.querySelector('.acc-head')?.setAttribute('aria-expanded','false');
            });
            if (!isOpen){
                item.classList.add('open');
                item.querySelector('.acc-head')?.setAttribute('aria-expanded','true');
            }
            // Recompute ScrollTrigger positions after accordion changes
            if (window.ScrollTrigger) ScrollTrigger.refresh();
        };

        items.forEach(item => {
            const head = item.querySelector('.acc-head');
            if (!head) return;
            head.onclick = () => toggle(item);
            head.onkeydown = (e) => {
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(item); }
            };
        });
    }

    /* ---------------- PROJECTS ---------------- */

    function renderProjects(projects){
        const wrap = document.getElementById("projectsWrap");
        if (!wrap) return;

        const list = Array.isArray(projects) ? projects : [];
        wrap.innerHTML = list.map((p) => {
            const side = (p?.side === "left") ? "left" : "right";
            const title = t(p?.title);
            const meta = maybeLocalizeDigits(t(p?.meta));
            const desc = t(p?.desc);
            const img = p?.image ?? "";

            return `
        <div class="project ${side}" data-side="${side}">
          <img class="img reveal" src="${escapeHtml(img)}" alt="${escapeHtml(title)}" />
          <div class="card ${side === "left" ? "reveal-left" : "reveal-right"}">
            <h3>${escapeHtml(title)}</h3>
            <div class="meta">${escapeHtml(meta)}</div>
            <p class="desc">${escapeHtml(desc)}</p>
          </div>
        </div>
      `;
        }).join("");
    }

    /* ---------------- GALLERY ---------------- */

    function renderGallery(gallery){
        const stage = document.getElementById("galleryStage");
        if (!stage) return;

        const word = stage.querySelector(".gallery-word");
        stage.innerHTML = "";
        if (word) stage.appendChild(word);

        const list = Array.isArray(gallery) ? gallery : [];
        const srcs = list.map(x => x?.image).filter(Boolean);

        const slots = ["g4","g5","g1","g2","g3"];
        for (let i=0; i<Math.min(5, srcs.length); i++){
            const cls = slots[i];
            const div = document.createElement("div");
            div.className = `g ${cls} ${i % 2 ? "reveal-right" : "reveal-left"}`;
            div.innerHTML = `<img loading="lazy" src="${escapeHtml(srcs[i])}" alt="">`;
            stage.appendChild(div);
        }
    }

    /* ---------------- CONTACT ICONS ---------------- */

    function iconPin(){
        return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M12 21s7-4.5 7-11a7 7 0 0 0-14 0c0 6.5 7 11 7 11Z"></path>
        <circle cx="12" cy="10" r="2.5"></circle>
      </svg>`;
    }
    function iconPhone(){
        return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M22 16.9v3a2 2 0 0 1-2.2 2 19.9 19.9 0 0 1-8.7-3.1A19.5 19.5 0 0 1 5.2 13a19.9 19.9 0 0 1-3.1-8.8A2 2 0 0 1 4.1 2h3a2 2 0 0 1 2 1.7c.1.9.3 1.8.6 2.6a2 2 0 0 1-.5 2.1L8.1 9.5a16 16 0 0 0 6.4 6.4l1.1-1.1a2 2 0 0 1 2.1-.5c.8.3 1.7.5 2.6.6A2 2 0 0 1 22 16.9Z"></path>
      </svg>`;
    }
    function iconInstagram(){
        return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <rect x="3" y="3" width="18" height="18" rx="5"></rect>
        <circle cx="12" cy="12" r="4"></circle>
        <circle cx="17.5" cy="6.5" r="1"></circle>
      </svg>`;
    }
    function iconWhatsApp(){
        return `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M20 11.8a8 8 0 0 1-11.7 7.1L4 20l1.1-4.1A8 8 0 1 1 20 11.8Z"></path>
        <path d="M9.2 9.1c.2-.5.5-.5.8-.5.2 0 .4 0 .6.1.2.1.4.2.5.5.1.3.3 1 .3 1.1 0 .2 0 .4-.2.6l-.3.4c-.1.1-.2.2-.1.4.1.2.4.7.9 1.2.6.6 1.1.9 1.3 1 .2.1.3.1.4-.1l.4-.5c.2-.2.4-.2.6-.1.2.1 1 .5 1.1.6.2.1.3.2.3.3 0 .1 0 .7-.3 1.1-.3.4-.8.7-1.3.7-.5 0-1.6-.2-3-1.2-1.7-1.2-2.7-2.8-3-3.3-.3-.6-.1-1 .1-1.2l.4-.5Z"></path>
      </svg>`;
    }
    function whatsappUrlFromE164(e164, message){
        const digits = String(e164 || "").replace(/[^\d]/g, "");
        if (!digits) return "#";
        const text = String(message || "").trim();
        const query = text ? `?text=${encodeURIComponent(text)}` : "";
        return `https://wa.me/${digits}${query}`;
    }

    function renderContact(){
        const wrap = document.getElementById("contactList");
        if (!wrap) return;

        const c = SITE?.partner?.contact || {};
        const address = t(c.address);
        const phoneLabel = t(c.phoneLabel) || (LANG === "ar" ? "الهاتف" : "Phone");
        const phone = c.phoneE164 || "";

        const waLabel = t(c.whatsappLabel) || (LANG === "ar" ? "واتساب" : "WhatsApp");
        const waNumber = c.whatsappNumberE164 || "";
        const waMessage = t(c.whatsappMessage);
        const waUrl = whatsappUrlFromE164(waNumber, waMessage);

        const igLabel = t(c.instagramLabel) || (LANG === "ar" ? "إنستغرام" : "Instagram");
        const igName = c.instagramName || "";
        const igUrl = c.instagramUrl || (igName ? `https://instagram.com/${igName}` : "#");

        const phoneDisplay = (LANG === "ar") ? toArabicIndicDigits(phone) : phone;
        const waDisplay = (LANG === "ar") ? toArabicIndicDigits(waNumber) : waNumber;

        const rows = [];

        if (address.trim()){
            rows.push(`
        <div class="contact-row">
          ${iconPin()}
          <div class="label">${escapeHtml(LANG === "ar" ? "العنوان" : "Address")}</div>
          <div class="value">${escapeHtml(address)}</div>
        </div>
      `);
        }

        if (phone.trim()){
            rows.push(`
        <div class="contact-row">
          ${iconPhone()}
          <div class="label">${escapeHtml(phoneLabel)}</div>
          <div class="value"><a href="tel:${escapeHtml(phone)}">${escapeHtml(phoneDisplay)}</a></div>
        </div>
      `);
        }

        if (waNumber.trim()){
            rows.push(`
        <div class="contact-row">
          ${iconWhatsApp()}
          <div class="label">${escapeHtml(waLabel)}</div>
          <div class="value"><a href="${escapeHtml(waUrl)}" target="_blank" rel="noreferrer">${escapeHtml(waDisplay)}</a></div>
        </div>
      `);
        }

        if (igUrl && igUrl !== "#"){
            rows.push(`
        <div class="contact-row">
          ${iconInstagram()}
          <div class="label">${escapeHtml(igLabel)}</div>
          <div class="value"><a href="${escapeHtml(igUrl)}" target="_blank" rel="noreferrer">@${escapeHtml(igName || "instagram")}</a></div>
        </div>
      `);
        }

        wrap.innerHTML = rows.join("");
    }

    /* ---------------- ANIMATIONS ---------------- */

    function clearScrollTriggers(){
        if (!window.ScrollTrigger) return;
        ScrollTrigger.getAll().forEach(t => t.kill());
    }

    function initAnimations(){
        if (!window.gsap || !window.ScrollTrigger) return;
        gsap.registerPlugin(ScrollTrigger);
        clearScrollTriggers();

        const revealTo = (selector) => {
            document.querySelectorAll(selector).forEach((el) => {
                gsap.fromTo(el,
                    {
                        opacity: 0,
                        x: el.classList.contains("reveal-left") ? -22 : el.classList.contains("reveal-right") ? 22 : 0,
                        y: el.classList.contains("reveal") ? 18 : 0
                    },
                    {
                        opacity: 1, x: 0, y: 0,
                        duration: 0.75,
                        ease: "power2.out",
                        scrollTrigger: {
                            trigger: el,
                            start: "top 85%",
                            toggleActions: "play none none none"
                        }
                    }
                );
            });
        };
        revealTo(".reveal");
        revealTo(".reveal-left");
        revealTo(".reveal-right");

        // initial wipes
        gsap.fromTo('[data-wipe-left]',  { scaleX: 1 }, { scaleX: 0, duration: 1.1, ease: "power3.out", delay: 0.1 });
        gsap.fromTo('[data-wipe-right]', { scaleX: 1 }, { scaleX: 0, duration: 1.1, ease: "power3.out", delay: 0.1 });

        // subtle hero parallax
        gsap.to("#heroTrack", {
            y: 18,
            ease: "none",
            scrollTrigger: { trigger: "#heroMedia", start: "top top", end: "bottom top", scrub: true }
        });

        // projects
        gsap.utils.toArray(".project").forEach((proj) => {
            const img = proj.querySelector(".img");
            const card = proj.querySelector(".card");
            const side = proj.dataset.side;

            gsap.fromTo(img, {opacity:0, y: 18}, {
                opacity:1, y:0, duration: .75, ease:"power2.out",
                scrollTrigger: { trigger: proj, start: "top 78%" }
            });

            gsap.fromTo(card,
                {opacity:0, x: side === "right" ? 26 : -26},
                {opacity:1, x:0, duration: .8, ease:"power2.out",
                    scrollTrigger: { trigger: proj, start: "top 78%" }
                }
            );
        });

        // gallery
        gsap.utils.toArray("#galleryStage .g").forEach((el, idx) => {
            gsap.fromTo(el,
                { opacity: 0, y: 26, rotate: (idx % 2 ? 1.0 : -1.0) },
                { opacity: 1, y: 0, rotate: 0, duration: .8, ease: "power2.out",
                    scrollTrigger: { trigger: "#galleryStage", start: "top 78%" }
                }
            );

            gsap.to(el, {
                y: (idx % 2 ? -14 : 14),
                ease: "none",
                scrollTrigger: { trigger: "#galleryStage", start: "top bottom", end: "bottom top", scrub: true }
            });
        });
    }

    function applyStaticLabels(){
        const isAr = LANG === "ar";

        document.getElementById("langLabel").textContent = isAr ? "العربية" : "English";

        document.getElementById("navAbout").textContent = isAr ? "من نحن" : "About";
        document.getElementById("navServices").textContent = isAr ? "الخدمات" : "Services";
        document.getElementById("navProjects").textContent = isAr ? "المشاريع" : "Projects";
        document.getElementById("navGallery").textContent = isAr ? "معرض الصور" : "Gallery";
        document.getElementById("navPartner").textContent = isAr ? "تواصل" : "Partner";

        document.getElementById("aboutTitle").textContent = isAr ? "من نحن" : "ABOUT";
        document.getElementById("servicesTitle").textContent = isAr ? "الخدمات" : "SERVICES";
        document.getElementById("projectsTitle").textContent = isAr ? "المشاريع" : "PROJECTS";
        document.getElementById("galleryTitle").textContent = isAr ? "معرض الصور" : "GALLERY";
        document.getElementById("galleryWord").textContent = isAr ? "معرض الصور" : "GALLERY";
    }

    function renderAll(){
        // Brand + logo
        document.getElementById("brandName").textContent = SITE?.brand?.name || "WM GROUP";
        if (SITE?.brand?.logo) document.getElementById("brandLogo").src = SITE.brand.logo;

        // HERO
        heroBuild();

        // About
        document.getElementById("aboutP1").textContent = t(SITE?.about?.p1);
        document.getElementById("aboutP2").textContent = t(SITE?.about?.p2);

        // Services / Projects / Gallery
        renderServices(SITE?.services);
        initAccordion();
        renderProjects(SITE?.projects);
        renderGallery(SITE?.gallery);

        // Partner
        document.getElementById("partnerTitle").textContent = t(SITE?.partner?.title);
        document.getElementById("partnerDesc").textContent = t(SITE?.partner?.desc);
        if (SITE?.partner?.image) document.getElementById("partnerImg").src = SITE.partner.image;
        renderContact();

        // Labels
        applyStaticLabels();
    }

    async function loadSiteContent(){
        const res = await fetch("./content/site.json", { cache: "no-store" });
        if (!res.ok) throw new Error("Failed to load ./content/site.json");
        SITE = await res.json();

        setLang(getLang());
        renderAll();
        initAnimations();
    }

    document.getElementById("langToggle")?.addEventListener("click", () => {
        setLang(getLang() === "en" ? "ar" : "en");
        renderAll();
        initAnimations();
    });

    loadSiteContent().catch((err) => {
        console.warn(err);
        setLang("en");
        applyStaticLabels();
        initAnimations();
    });
</script>

<!-- Netlify Identity (Decap CMS auth) -->
</body>
</html>
