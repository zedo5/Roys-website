<!doctype html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>WM GROUP</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root{
            --black:#1e1e1e;
            --grey:#6f6f6f;
            --white:#ffffff;
            --container: 1200px;
            --shadow: 0 18px 50px rgba(0,0,0,.14);
            --soft-shadow: 0 12px 30px rgba(0,0,0,.10);
        }

        *{box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{
            margin:0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color:var(--black);
            background:var(--white);
            line-height:1.45;
        }
        a{color:inherit;text-decoration:none}
        img{max-width:100%;display:block}
        .container{max-width: var(--container); margin: 0 auto; padding: 0 22px;}

        /* Top bar */
        .topbar{
            position: sticky; top: 0; z-index: 50;
            background: rgba(255,255,255,.92);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(30,30,30,.08);
        }
        .nav{
            display:flex; align-items:center; justify-content:space-between;
            gap: 16px; padding: 14px 0;
        }
        .brand{
            display:flex; align-items:center; gap:10px;
            line-height:1.1;
        }
        .brand .logo{
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 12px;
        }
        .brand strong{font-weight:800;letter-spacing:.02em;font-size:18px}

        .navright{display:flex;gap:14px;align-items:center}
        .navlinks{display:flex;gap:18px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
        .navlinks a{font-size:12px;opacity:.9}

        /* Language toggle (more natural) */
        .langbtn{
            font: inherit;
            font-size: 12px;
            font-weight: 700;
            border: 1px solid rgba(30,30,30,.14);
            background: #fff;
            padding: 8px 12px;
            border-radius: 999px;
            cursor: pointer;
            letter-spacing: .02em;
            display:flex;
            align-items:center;
            gap:8px;
            user-select:none;
        }
        .langdot{
            width: 8px; height: 8px; border-radius: 999px;
            background: rgba(30,30,30,.55);
        }
        .langbtn:active{transform: translateY(1px);}

        /* HERO */
        .hero{padding:18px 0 0}
        .hero .container{max-width: 100%; padding: 0;}
        .hero-media{position:relative; overflow:hidden; background:#eee;}
        .hero-img{
            width:100%;
            height: clamp(520px, 82vh, 860px);
            object-fit: cover;
            transform-origin:center;
            position: relative;
            z-index: 1;
        }

        /* Center-split open wipes */
        .wipe{
            position:absolute; top:0; width:50%; height:100%;
            background: var(--white); z-index: 5; pointer-events:none;
            transform: scaleX(1);
        }
        .wipe.split.left{left:0; transform-origin:left;}
        .wipe.split.right{right:0; transform-origin:right;}

        /* WM GROUP overlay (transparent but more visible) */
        .hero-word{
            position:absolute;
            left: 60px;
            top: 110px;
            font-weight: 800;
            font-size: clamp(64px, 10vw, 160px);
            letter-spacing: .08em;
            color: rgba(10,10,10,.30);
            text-transform: uppercase;
            pointer-events:none;
            user-select:none;
            white-space:nowrap;
            mix-blend-mode: multiply;
            text-shadow: 0 2px 18px rgba(255,255,255,.18);
            z-index: 6;
            display: none !important;
        }

        section{padding: 80px 0;}
        .split{
            display:grid;
            grid-template-columns: 1fr 520px;
            gap: 60px;
            align-items:start;
        }
        .big-title{
            font-size: clamp(44px, 6vw, 74px);
            font-weight: 800;
            letter-spacing: -0.03em;
            margin: 0;
            text-transform: uppercase;
        }
        .right{justify-self:end;width:100%}

        /* About */
        .about-copy p{
            margin: 0 0 14px;
            color: var(--grey);
            font-size: 14px;
            max-width: 52ch;
            white-space: pre-wrap;
        }

        /* Services accordion */
        .accordion{border-top: 1px solid rgba(30,30,30,.12)}
        .acc-item{border-bottom: 1px solid rgba(30,30,30,.12); padding: 18px 0}
        .acc-head{
            display:grid;
            grid-template-columns: 58px 1fr 28px;
            gap: 12px;
            align-items:center;
            cursor:pointer;
            user-select:none;
        }
        .acc-num{font-size: 12px;color: var(--grey); font-weight:700;}
        .acc-title{font-weight: 700;font-size: 14px}
        .acc-plus{font-size: 22px; line-height: 1; justify-self:end; transition: transform .25s ease;}
        .acc-panel{
            display:grid;
            grid-template-columns: 1fr 220px;
            gap: 16px;
            padding: 12px 0 0 70px;
            overflow:hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height .45s ease, opacity .35s ease;
        }
        .acc-item.open .acc-panel{max-height: 520px; opacity: 1}
        .acc-item.open .acc-plus{transform: rotate(45deg)}
        .acc-panel p{margin:0 0 10px;color:var(--grey);font-size:13px;max-width:46ch;white-space:pre-wrap}
        .bullets{margin:0;padding-left:16px;color:var(--grey);font-size:12px;display:grid;gap:6px}
        .acc-panel img{width:100%;height:160px;object-fit:cover;border-radius:10px;box-shadow: var(--soft-shadow);}

        /* Projects */
        .projects-wrap{margin-top: 20px;}
        .project{position: relative; padding: 38px 0;}
        .project .img{width: 100%; height: clamp(340px, 50vh, 520px); object-fit: cover;}
        .project .card{
            position:absolute; top: 88px; width: 340px;
            background: rgba(255,255,255,.92);
            border: 1px solid rgba(30,30,30,.10);
            box-shadow: var(--shadow);
            padding: 22px;
        }
        .project.right .card{right: 0;}
        .project.left  .card{left: 0;}
        .project h3{margin:0 0 8px;font-size:14px;font-weight:800}
        .project .meta{font-size:11px;color:var(--grey);margin:0 0 10px}
        .project .desc{margin:0;color:var(--grey);font-size:12px;line-height:1.6;white-space:pre-wrap}

        /* Gallery */
        .gallery-title-center{
            text-align:center;
            font-size: clamp(64px, 10vw, 150px);
            font-weight: 800;
            letter-spacing: -0.02em;
            margin: 0;
            padding: 0 0 40px;
            text-transform: uppercase;
        }
        .gallery-stage{position: relative; height: 560px; margin-top: 10px; overflow: visible;}
        .gallery-word{
            position:absolute; left: 50%; top: 48%;
            transform: translate(-50%,-50%);
            font-size: clamp(70px, 10vw, 160px);
            font-weight: 800; letter-spacing: .06em;
            color: rgba(30,30,30,.18);
            text-transform: uppercase;
            white-space:nowrap;
            user-select:none;
            pointer-events:none;
        }
        .g{position:absolute; box-shadow: var(--soft-shadow); overflow:hidden; background:#f2f2f2;}
        .g img{width:100%;height:100%;object-fit:cover}
        .g1{left: 14%; top: 160px; width: 260px; height: 260px;}
        .g2{left: 42%; top: 12px;  width: 340px; height: 380px;}
        .g3{left: 72%; top: 260px; width: 260px; height: 260px;}
        .g4{left: 30%; top: -40px; width: 320px; height: 220px;}
        .g5{left: 66%; top: -60px; width: 320px; height: 220px;}

        /* Partner */
        .partner{padding: 0; background: var(--white);}
        .partner-grid{display:grid; grid-template-columns: 1fr 1fr; min-height: 720px;}
        .partner-left{padding: 90px 70px 60px 70px;}
        .partner-title{
            margin:0 0 18px;
            font-size: 76px; line-height: 0.95;
            font-weight: 800; letter-spacing: -0.04em;
            text-transform: uppercase;
        }
        .partner-desc{margin:0 0 18px;color: var(--grey);font-size: 14px;max-width: 62ch;white-space:pre-wrap}

        /* Contact rows (icon + text; links open apps) */
        .contact-list{display:grid; gap: 14px; margin-top: 10px; max-width: 600px;}
        .contact-row{
            display:flex;
            align-items:flex-start;
            gap: 12px;
            color: rgba(30,30,30,.78);
            font-weight: 700;
        }
        .contact-row svg{width: 22px; height: 22px; flex: 0 0 auto; margin-top: 2px; opacity:.85;}
        .contact-row .label{min-width: 110px; color: rgba(30,30,30,.55); font-weight: 800;}
        .contact-row a{color: rgba(30,30,30,.78); text-decoration:none;}
        .contact-row a:hover{opacity:.85}
        .contact-row .value{font-weight: 700; color: rgba(30,30,30,.78); white-space: pre-wrap;}

        .partner-right{position: relative; overflow:hidden; background:#eee;}
        .partner-right img{width:100%; height:100%; object-fit: cover; transform-origin:center;}

        /* Reveals */
        .reveal{opacity:0; transform: translateY(18px);}
        .reveal-left{opacity:0; transform: translateX(-22px);}
        .reveal-right{opacity:0; transform: translateX(22px);}

        /* RTL adjustments */
        html[dir="rtl"] .hero-word{left:auto; right:60px; letter-spacing:.04em;}
        html[dir="rtl"] .about-copy, html[dir="rtl"] .partner-left{ text-align:right; }
        html[dir="rtl"] .acc-panel{padding: 12px 70px 0 0;}
        html[dir="rtl"] .bullets{padding-left:0; padding-right:16px;}
        html[dir="rtl"] .project.right .card{right:auto; left:0;}
        html[dir="rtl"] .project.left  .card{left:auto; right:0;}
        html[dir="rtl"] .contact-row{flex-direction: row-reverse;}
        html[dir="rtl"] .contact-row .label{min-width: 120px; text-align:right;}

        @media (max-width: 980px){
            .split{grid-template-columns: 1fr; gap: 22px;}
            .right{justify-self:start; max-width: 720px;}
            .project .card{position:relative; top:auto; left:auto; right:auto; width: 100%; margin-top: 16px;}
            .gallery-stage{height: 720px;}
            .g1,.g2,.g3,.g4,.g5{position:relative; left:auto; top:auto; width:100%; height:240px; margin-bottom:14px;}
            .gallery-word{display:none;}
            .navlinks{display:none;}
            .partner-grid{grid-template-columns:1fr}
            .partner-left{padding: 64px 22px}
            .partner-title{font-size: 56px}
            .hero-word{left:22px; top: 90px;}
            html[dir="rtl"] .hero-word{left:auto; right:22px;}
        }
        @media (max-width: 520px){
            section{padding: 64px 0;}
            .hero-img{height: 72vh;}
            .brand strong{font-size:16px}
        }

        @media (max-width: 768px){

            /* A) Hero text */
            .hero-word{
                font-size: clamp(42px, 12vw, 78px);
                letter-spacing: .04em;
                top: 70px;
                opacity: .32;
            }

            /* B) Services accordion layout */
            .acc-panel{
                grid-template-columns: 1fr;
                padding-left: 0;
            }

            .acc-panel img{
                height: 200px;
                margin-top: 12px;
            }

            /* C) Projects layout */
            .project{
                padding: 24px 0;
            }

            .project .card{
                position: relative;
                top: auto;
                left: auto;
                right: auto;
                width: 100%;
                margin-top: 14px;
            }

            .project .img{
                height: 260px;
            }

            /* D) Partner contact spacing */
            .contact-row{
                gap: 10px;
                font-size: 14px;
            }

            .contact-row svg{
                width: 24px;
                height: 24px;
            }

            .partner-title{
                font-size: 48px;
            }
        }
    </style>
</head>

<body>
<header class="topbar">
    <div class="container">
        <div class="nav">
            <a class="brand" href="#top">
                <img class="logo" id="brandLogo" src="/assets/uploads/logo.png" alt="Logo" />
                <strong id="brandName">WM GROUP</strong>
            </a>

            <div class="navright">
                <nav class="navlinks" aria-label="Primary">
                    <a href="#about" id="navAbout">About</a>
                    <a href="#services" id="navServices">Services</a>
                    <a href="#projects" id="navProjects">Projects</a>
                    <a href="#gallery" id="navGallery">Gallery</a>
                    <a href="#partner" id="navPartner">Partner</a>
                </nav>

                <button id="langToggle" class="langbtn" type="button" aria-label="Change language">
                    <span class="langdot" aria-hidden="true"></span>
                    <span id="langLabel">English</span>
                </button>
            </div>
        </div>
    </div>
</header>

<!-- HERO -->
<main id="top" class="hero">
    <div class="container">
        <div class="hero-media" id="heroMedia">
            <div class="wipe split left" data-wipe-left></div>
            <div class="wipe split right" data-wipe-right></div>

            <div class="hero-word" id="heroWord">WM GROUP</div>

            <img class="hero-img" id="heroImg" src="/assets/uploads/picture-1.jpg" alt="Hero" />
        </div>
    </div>
</main>

<!-- ABOUT -->
<section id="about">
    <div class="container">
        <div class="split">
            <h2 class="big-title reveal-left" id="aboutTitle">ABOUT</h2>
            <div class="right about-copy">
                <p id="aboutP1" class="reveal"></p>
                <p id="aboutP2" class="reveal"></p>
            </div>
        </div>
    </div>
</section>

<!-- SERVICES -->
<section id="services">
    <div class="container">
        <div class="split">
            <h2 class="big-title reveal-left" id="servicesTitle">SERVICES</h2>
            <div class="right reveal">
                <div class="accordion" id="servicesAccordion"></div>
            </div>
        </div>
    </div>
</section>

<!-- PROJECTS -->
<section id="projects">
    <div class="container">
        <div class="split">
            <h2 class="big-title reveal-left" id="projectsTitle">PROJECTS</h2>
            <div class="right"></div>
        </div>
        <div class="projects-wrap" id="projectsWrap"></div>
    </div>
</section>

<!-- GALLERY -->
<section id="gallery">
    <div class="container">
        <h2 class="gallery-title-center reveal" id="galleryTitle">GALLERY</h2>

        <div class="gallery-stage" id="galleryStage">
            <div class="gallery-word reveal" id="galleryWord">GALLERY</div>
        </div>
    </div>
</section>

<!-- PARTNER -->
<section id="partner" class="partner">
    <div class="partner-grid">
        <div class="partner-left">
            <h2 class="partner-title reveal-left" id="partnerTitle"></h2>
            <p class="partner-desc reveal" id="partnerDesc"></p>

            <div class="contact-list reveal" id="contactList"></div>
        </div>

        <div class="partner-right reveal-right">
            <img id="partnerImg" src="/assets/uploads/picture-14.jpg" alt="Partner" />
        </div>
    </div>
</section>

<!-- GSAP -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>

<script>
    function escapeHtml(s){
        return String(s ?? "")
            .replaceAll("&","&amp;")
            .replaceAll("<","&lt;")
            .replaceAll(">","&gt;")
            .replaceAll('"',"&quot;")
            .replaceAll("'","&#039;");
    }

    // Arabic-Indic digits: ٠١٢٣٤٥٦٧٨٩
    const AR_DIGITS = ["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];
    function toArabicIndicDigits(str){
        return String(str ?? "").replace(/\d/g, d => AR_DIGITS[Number(d)]);
    }

    let SITE = null;
    let LANG = "en";

    function getLang(){
        return localStorage.getItem("lang") || (SITE?.langDefault ?? "en");
    }
    function setLang(lang){
        LANG = (lang === "ar") ? "ar" : "en";
        localStorage.setItem("lang", LANG);
        document.documentElement.lang = LANG;
        document.documentElement.dir = (LANG === "ar") ? "rtl" : "ltr";
    }

    // localized field: string OR {en, ar}
    function t(value){
        if (value == null) return "";
        if (typeof value === "string") return value;
        return value[LANG] ?? value.en ?? value.ar ?? "";
    }

    function maybeLocalizeDigits(str){
        return (LANG === "ar") ? toArabicIndicDigits(str) : String(str ?? "");
    }

    // ---------- services ----------
    function renderServices(services){
        const wrap = document.getElementById("servicesAccordion");
        if (!wrap) return;

        const list = Array.isArray(services) ? services : [];
        wrap.innerHTML = list.map((s, idx) => {
            const open = idx === 0 ? "open" : "";
            const numRaw = s?.num ?? String(idx+1).padStart(2,"0");
            const num = (LANG === "ar") ? toArabicIndicDigits(numRaw) : String(numRaw);

            const bullets = Array.isArray(s?.bullets) ? s.bullets : [];
            const bulletsHtml = bullets.map(b => `<li>${escapeHtml(t(b?.bullet ?? b))}</li>`).join("");

            const title = t(s?.title);
            const text = t(s?.text);
            const img = s?.image ?? "";

            return `
          <div class="acc-item ${open}">
            <div class="acc-head" role="button" tabindex="0" aria-expanded="${idx === 0 ? "true" : "false"}">
              <div class="acc-num">${escapeHtml(num)}</div>
              <div class="acc-title">${escapeHtml(title)}</div>
              <div class="acc-plus">+</div>
            </div>

            <div class="acc-panel">
              <div>
                <p>${escapeHtml(text)}</p>
                <ul class="bullets">${bulletsHtml}</ul>
              </div>
              <img src="${escapeHtml(img)}" alt="${escapeHtml(title)}" />
            </div>
          </div>
        `;
        }).join("");
    }

    function initAccordion(){
        const items = Array.from(document.querySelectorAll('#servicesAccordion .acc-item'));
        const toggle = (item) => {
            const isOpen = item.classList.contains('open');
            items.forEach(i => {
                i.classList.remove('open');
                i.querySelector('.acc-head')?.setAttribute('aria-expanded','false');
            });
            if (!isOpen){
                item.classList.add('open');
                item.querySelector('.acc-head')?.setAttribute('aria-expanded','true');
            }
        };

        items.forEach(item => {
            const head = item.querySelector('.acc-head');
            if (!head) return;
            head.onclick = () => toggle(item);
            head.onkeydown = (e) => {
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(item); }
            };
        });
    }

    // ---------- projects ----------
    function renderProjects(projects){
        const wrap = document.getElementById("projectsWrap");
        if (!wrap) return;

        const list = Array.isArray(projects) ? projects : [];
        wrap.innerHTML = list.map((p) => {
            const side = (p?.side === "left") ? "left" : "right";
            const title = t(p?.title);
            const meta = maybeLocalizeDigits(t(p?.meta));
            const desc = t(p?.desc);
            const img = p?.image ?? "";

            return `
          <div class="project ${side}" data-side="${side}">
            <img class="img reveal" src="${escapeHtml(img)}" alt="${escapeHtml(title)}" />
            <div class="card ${side === "left" ? "reveal-left" : "reveal-right"}">
              <h3>${escapeHtml(title)}</h3>
              <div class="meta">${escapeHtml(meta)}</div>
              <p class="desc">${escapeHtml(desc)}</p>
            </div>
          </div>
        `;
        }).join("");
    }

    // ---------- gallery ----------
    function renderGallery(gallery){
        const stage = document.getElementById("galleryStage");
        if (!stage) return;

        const word = stage.querySelector(".gallery-word");
        stage.innerHTML = "";
        if (word) stage.appendChild(word);

        const list = Array.isArray(gallery) ? gallery : [];
        const srcs = list.map(x => x?.image).filter(Boolean);

        const slots = ["g4","g5","g1","g2","g3"];
        for (let i=0; i<Math.min(5, srcs.length); i++){
            const cls = slots[i];
            const div = document.createElement("div");
            div.className = `g ${cls} ${i % 2 ? "reveal-right" : "reveal-left"}`;
            div.innerHTML = `<img src="${escapeHtml(srcs[i])}" alt="">`;
            stage.appendChild(div);
        }
    }

    // ---------- contact icons (inline SVG) ----------
    function iconPin(){
        return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M12 21s7-4.5 7-11a7 7 0 0 0-14 0c0 6.5 7 11 7 11Z"></path>
          <circle cx="12" cy="10" r="2.5"></circle>
        </svg>`;
    }
    function iconPhone(){
        return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M22 16.9v3a2 2 0 0 1-2.2 2 19.9 19.9 0 0 1-8.7-3.1A19.5 19.5 0 0 1 5.2 13a19.9 19.9 0 0 1-3.1-8.8A2 2 0 0 1 4.1 2h3a2 2 0 0 1 2 1.7c.1.9.3 1.8.6 2.6a2 2 0 0 1-.5 2.1L8.1 9.5a16 16 0 0 0 6.4 6.4l1.1-1.1a2 2 0 0 1 2.1-.5c.8.3 1.7.5 2.6.6A2 2 0 0 1 22 16.9Z"></path>
        </svg>`;
    }
    function iconInstagram(){
        return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="3" width="18" height="18" rx="5"></rect>
          <circle cx="12" cy="12" r="4"></circle>
          <circle cx="17.5" cy="6.5" r="1"></circle>
        </svg>`;
    }
    function iconWhatsApp(){
        return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M20 11.8a8 8 0 0 1-11.7 7.1L4 20l1.1-4.1A8 8 0 1 1 20 11.8Z"></path>
          <path d="M9.2 9.1c.2-.5.5-.5.8-.5.2 0 .4 0 .6.1.2.1.4.2.5.5.1.3.3 1 .3 1.1 0 .2 0 .4-.2.6l-.3.4c-.1.1-.2.2-.1.4.1.2.4.7.9 1.2.6.6 1.1.9 1.3 1 .2.1.3.1.4-.1l.4-.5c.2-.2.4-.2.6-.1.2.1 1 .5 1.1.6.2.1.3.2.3.3 0 .1 0 .7-.3 1.1-.3.4-.8.7-1.3.7-.5 0-1.6-.2-3-1.2-1.7-1.2-2.7-2.8-3-3.3-.3-.6-.1-1 .1-1.2l.4-.5Z"></path>
        </svg>`;
    }

    function whatsappUrlFromE164(e164){
        const digits = String(e164 || "").replace(/[^\d]/g, "");
        return digits ? `https://wa.me/${digits}` : "#";
    }

    function renderContact(){
        const wrap = document.getElementById("contactList");
        if (!wrap) return;

        const c = SITE?.partner?.contact || {};

        const address = t(c.address);
        const phoneLabel = t(c.phoneLabel) || (LANG === "ar" ? "الهاتف" : "Phone");
        const phone = c.phoneE164 || "";

        const waLabel = t(c.whatsappLabel) || (LANG === "ar" ? "واتساب" : "WhatsApp");
        const waNumber = c.whatsappNumberE164 || "";
        const waUrl = whatsappUrlFromE164(waNumber);

        const igLabel = t(c.instagramLabel) || (LANG === "ar" ? "إنستغرام" : "Instagram");
        const igName = c.instagramName || "";
        const igUrl = c.instagramUrl || (igName ? `https://instagram.com/${igName}` : "#");

        const phoneDisplay = (LANG === "ar") ? toArabicIndicDigits(phone) : phone;
        const waDisplay = (LANG === "ar") ? toArabicIndicDigits(waNumber) : waNumber;

        // Address is static text (not a button/link)
        const rows = [];

        if (address.trim()){
            rows.push(`
          <div class="contact-row">
            ${iconPin()}
            <div class="label">${escapeHtml(LANG === "ar" ? "العنوان" : "Address")}</div>
            <div class="value">${escapeHtml(address)}</div>
          </div>
        `);
        }

        if (phone.trim()){
            rows.push(`
          <div class="contact-row">
            ${iconPhone()}
            <div class="label">${escapeHtml(phoneLabel)}</div>
            <div class="value"><a href="tel:${escapeHtml(phone)}">${escapeHtml(phoneDisplay)}</a></div>
          </div>
        `);
        }

        if (waNumber.trim()){
            rows.push(`
          <div class="contact-row">
            ${iconWhatsApp()}
            <div class="label">${escapeHtml(waLabel)}</div>
            <div class="value"><a href="${escapeHtml(waUrl)}" target="_blank" rel="noreferrer">${escapeHtml(waDisplay)}</a></div>
          </div>
        `);
        }

        if (igUrl && igUrl !== "#"){
            rows.push(`
          <div class="contact-row">
            ${iconInstagram()}
            <div class="label">${escapeHtml(igLabel)}</div>
            <div class="value"><a href="${escapeHtml(igUrl)}" target="_blank" rel="noreferrer">@${escapeHtml(igName || "instagram")}</a></div>
          </div>
        `);
        }

        wrap.innerHTML = rows.join("");
    }

    // ---------- animations ----------
    function clearScrollTriggers(){
        if (!window.ScrollTrigger) return;
        ScrollTrigger.getAll().forEach(t => t.kill());
    }

    function initAnimations(){
        if (!window.gsap || !window.ScrollTrigger) return;
        gsap.registerPlugin(ScrollTrigger);
        clearScrollTriggers();

        const revealTo = (selector) => {
            document.querySelectorAll(selector).forEach((el) => {
                gsap.fromTo(el,
                    { opacity: 0, x: el.classList.contains("reveal-left") ? -22 : el.classList.contains("reveal-right") ? 22 : 0, y: el.classList.contains("reveal") ? 18 : 0 },
                    {
                        opacity: 1, x: 0, y: 0,
                        duration: 0.75,
                        ease: "power2.out",
                        scrollTrigger: {
                            trigger: el,
                            start: "top 85%",
                            end: "bottom 60%",
                            toggleActions: "play reverse play reverse"
                        }
                    }
                );
            });
        };
        revealTo(".reveal");
        revealTo(".reveal-left");
        revealTo(".reveal-right");

        gsap.fromTo('[data-wipe-left]',  { scaleX: 1 }, { scaleX: 0, duration: 1.1, ease: "power3.out", delay: 0.1 });
        gsap.fromTo('[data-wipe-right]', { scaleX: 1 }, { scaleX: 0, duration: 1.1, ease: "power3.out", delay: 0.1 });

        gsap.fromTo("#heroImg", { scale: 1.06 }, { scale: 1.0, duration: 1.1, ease: "power2.out" });

        gsap.to("#heroWord", {
            y: 70,
            ease: "none",
            scrollTrigger: { trigger: "#heroMedia", start: "top top", end: "bottom top", scrub: true }
        });
        gsap.to("#heroImg", {
            y: 30,
            ease: "none",
            scrollTrigger: { trigger: "#heroMedia", start: "top top", end: "bottom top", scrub: true }
        });

        gsap.utils.toArray(".project").forEach((proj) => {
            const img = proj.querySelector(".img");
            const card = proj.querySelector(".card");
            const side = proj.dataset.side;

            gsap.fromTo(img, {opacity:0, y: 18}, {
                opacity:1, y:0, duration: .75, ease:"power2.out",
                scrollTrigger: { trigger: proj, start: "top 78%" }
            });

            gsap.fromTo(card,
                {opacity:0, x: side === "right" ? 26 : -26},
                {
                    opacity:1, x:0, duration: .8, ease:"power2.out",
                    scrollTrigger: { trigger: proj, start: "top 78%" }
                }
            );
        });

        gsap.utils.toArray("#galleryStage .g").forEach((el, idx) => {
            gsap.fromTo(el,
                { opacity: 0, y: 26, rotate: (idx % 2 ? 1.0 : -1.0) },
                {
                    opacity: 1, y: 0, rotate: 0,
                    duration: .8,
                    ease: "power2.out",
                    scrollTrigger: { trigger: "#galleryStage", start: "top 78%" }
                }
            );

            gsap.to(el, {
                y: (idx % 2 ? -14 : 14),
                ease: "none",
                scrollTrigger: { trigger: "#galleryStage", start: "top bottom", end: "bottom top", scrub: true }
            });
        });
    }

    function applyStaticLabels(){
        const isAr = LANG === "ar";

        document.getElementById("langLabel").textContent = isAr ? "العربية" : "English";

        document.getElementById("navAbout").textContent = isAr ? "من نحن" : "About";
        document.getElementById("navServices").textContent = isAr ? "الخدمات" : "Services";
        document.getElementById("navProjects").textContent = isAr ? "المشاريع" : "Projects";
        document.getElementById("navGallery").textContent = isAr ? "معرض الصور" : "Gallery";
        document.getElementById("navPartner").textContent = isAr ? "تواصل" : "Partner";

        document.getElementById("aboutTitle").textContent = isAr ? "من نحن" : "ABOUT";
        document.getElementById("servicesTitle").textContent = isAr ? "الخدمات" : "SERVICES";
        document.getElementById("projectsTitle").textContent = isAr ? "المشاريع" : "PROJECTS";
        document.getElementById("galleryTitle").textContent = isAr ? "معرض الصور" : "GALLERY";
        document.getElementById("galleryWord").textContent = isAr ? "معرض الصور" : "GALLERY";
    }

    function renderAll(){
        // Brand + logo
        document.getElementById("brandName").textContent = SITE?.brand?.name || "WM GROUP";
        if (SITE?.brand?.logo) document.getElementById("brandLogo").src = SITE.brand.logo;

        // Hero
        document.getElementById("heroWord").textContent = t(SITE?.hero?.word) || "WM GROUP";
        if (SITE?.hero?.image) document.getElementById("heroImg").src = SITE.hero.image;

        // About
        document.getElementById("aboutP1").textContent = t(SITE?.about?.p1);
        document.getElementById("aboutP2").textContent = t(SITE?.about?.p2);

        // Services / Projects / Gallery
        renderServices(SITE?.services);
        initAccordion();
        renderProjects(SITE?.projects);
        renderGallery(SITE?.gallery);

        // Partner
        document.getElementById("partnerTitle").textContent = t(SITE?.partner?.title);
        document.getElementById("partnerDesc").textContent = t(SITE?.partner?.desc);
        if (SITE?.partner?.image) document.getElementById("partnerImg").src = SITE.partner.image;
        renderContact();

        // Labels
        applyStaticLabels();
    }

    async function loadSiteContent(){
        const res = await fetch("./content/site.json", { cache: "no-store" });
        if (!res.ok) throw new Error("Failed to load ./content/site.json");
        SITE = await res.json();

        setLang(getLang());
        renderAll();
        initAnimations();
    }

    document.getElementById("langToggle")?.addEventListener("click", () => {
        setLang(getLang() === "en" ? "ar" : "en");
        renderAll();
        initAnimations();
    });

    loadSiteContent().catch((err) => {
        console.warn(err);
        setLang("en");
        applyStaticLabels();
        initAnimations();
    });
</script>

<!-- Netlify Identity (required for Decap CMS auth) -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</body>
</html>